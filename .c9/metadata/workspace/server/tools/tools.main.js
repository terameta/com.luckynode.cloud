{"filter":false,"title":"tools.main.js","tooltip":"/server/tools/tools.main.js","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":103,"column":49},"end":{"row":103,"column":50},"action":"remove","lines":["\t"],"id":84}],[{"start":{"row":103,"column":49},"end":{"row":103,"column":50},"action":"remove","lines":["\t"],"id":85}],[{"start":{"row":103,"column":49},"end":{"row":103,"column":50},"action":"remove","lines":["\t"],"id":86}],[{"start":{"row":103,"column":49},"end":{"row":103,"column":50},"action":"remove","lines":["\t"],"id":87}],[{"start":{"row":103,"column":49},"end":{"row":103,"column":50},"action":"remove","lines":["\t"],"id":88}],[{"start":{"row":103,"column":90},"end":{"row":104,"column":0},"action":"remove","lines":["",""],"id":89}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"remove","lines":["\t"],"id":90}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"remove","lines":["\t"],"id":91}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"remove","lines":["\t"],"id":92}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"remove","lines":["\t"],"id":93}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"remove","lines":["\t"],"id":94}],[{"start":{"row":103,"column":89},"end":{"row":103,"column":90},"action":"insert","lines":[" "],"id":95}],[{"start":{"row":103,"column":90},"end":{"row":103,"column":91},"action":"insert","lines":["D"],"id":96}],[{"start":{"row":103,"column":91},"end":{"row":103,"column":92},"action":"insert","lines":["B"],"id":97}],[{"start":{"row":103,"column":92},"end":{"row":103,"column":93},"action":"insert","lines":[" "],"id":98}],[{"start":{"row":103,"column":93},"end":{"row":103,"column":94},"action":"insert","lines":["e"],"id":99}],[{"start":{"row":103,"column":94},"end":{"row":103,"column":95},"action":"insert","lines":["r"],"id":100}],[{"start":{"row":103,"column":95},"end":{"row":103,"column":96},"action":"insert","lines":["r"],"id":101}],[{"start":{"row":103,"column":96},"end":{"row":103,"column":97},"action":"insert","lines":["o"],"id":102}],[{"start":{"row":103,"column":97},"end":{"row":103,"column":98},"action":"insert","lines":["r"],"id":103}],[{"start":{"row":104,"column":20},"end":{"row":104,"column":21},"action":"remove","lines":["{"],"id":104},{"start":{"row":104,"column":20},"end":{"row":104,"column":110},"action":"insert","lines":["{ return res.json({\tstatus: 'fail',\tmessage: 'Failed to authenticate token. DB error'}); }"]}],[{"start":{"row":104,"column":96},"end":{"row":104,"column":104},"action":"remove","lines":["DB error"],"id":105},{"start":{"row":104,"column":96},"end":{"row":104,"column":97},"action":"insert","lines":["N"]}],[{"start":{"row":104,"column":97},"end":{"row":104,"column":98},"action":"insert","lines":["o"],"id":106}],[{"start":{"row":104,"column":98},"end":{"row":104,"column":99},"action":"insert","lines":[" "],"id":107}],[{"start":{"row":104,"column":99},"end":{"row":104,"column":100},"action":"insert","lines":["u"],"id":108}],[{"start":{"row":104,"column":100},"end":{"row":104,"column":101},"action":"insert","lines":["s"],"id":109}],[{"start":{"row":104,"column":101},"end":{"row":104,"column":102},"action":"insert","lines":["e"],"id":110}],[{"start":{"row":104,"column":102},"end":{"row":104,"column":103},"action":"insert","lines":["r"],"id":111}],[{"start":{"row":104,"column":103},"end":{"row":104,"column":104},"action":"insert","lines":["."],"id":112}],[{"start":{"row":103,"column":98},"end":{"row":103,"column":99},"action":"insert","lines":["."],"id":113}],[{"start":{"row":105,"column":0},"end":{"row":105,"column":66},"action":"remove","lines":["\t\t\t\t\t\t\tif( data == null){ res.status(401).json({status:'fail'}); }"],"id":114}],[{"start":{"row":104,"column":110},"end":{"row":105,"column":0},"action":"remove","lines":["",""],"id":115}],[{"start":{"row":105,"column":0},"end":{"row":105,"column":1},"action":"remove","lines":["\t"],"id":116},{"start":{"row":106,"column":0},"end":{"row":106,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":107,"column":0},"end":{"row":107,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":108,"column":0},"end":{"row":108,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":109,"column":0},"end":{"row":109,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":110,"column":0},"end":{"row":110,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":111,"column":0},"end":{"row":111,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":112,"column":0},"end":{"row":112,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":113,"column":0},"end":{"row":113,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":114,"column":0},"end":{"row":114,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":115,"column":0},"end":{"row":115,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":116,"column":0},"end":{"row":116,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":117,"column":0},"end":{"row":117,"column":1},"action":"remove","lines":["\t"]},{"start":{"row":118,"column":0},"end":{"row":118,"column":1},"action":"remove","lines":["\t"]}],[{"start":{"row":119,"column":0},"end":{"row":119,"column":7},"action":"remove","lines":["\t\t\t\t\t\t}"],"id":117}],[{"start":{"row":118,"column":7},"end":{"row":119,"column":0},"action":"remove","lines":["",""],"id":118}],[{"start":{"row":106,"column":7},"end":{"row":117,"column":8},"action":"remove","lines":["if(!tools.compareHash(req.body.pass, data.pass)){","\t\t\t\t\t\t\t\tres.status(401).json({status:'fail'});","\t\t\t\t\t\t\t} else {","\t\t\t\t\t\t\t\tvar token = tools.jwt.sign(data.email, app.get('jwtsecret'), {","\t\t\t\t\t\t\t\t\texpiresInMinutes: 60*24*30 // expires in 30 days","\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t\tres.json({","\t\t\t\t\t\t\t\t\tstatus: 'success',","\t\t\t\t\t\t\t\t\tmessage: 'Enjoy your token!',","\t\t\t\t\t\t\t\t\ttoken: token","\t\t\t\t\t\t\t\t});","\t\t\t\t\t\t\t}"],"id":119}],[{"start":{"row":109,"column":5},"end":{"row":109,"column":12},"action":"remove","lines":["next();"],"id":120}],[{"start":{"row":106,"column":7},"end":{"row":106,"column":14},"action":"insert","lines":["next();"],"id":121}],[{"start":{"row":109,"column":0},"end":{"row":109,"column":5},"action":"remove","lines":["\t\t\t\t\t"],"id":122}],[{"start":{"row":108,"column":8},"end":{"row":109,"column":0},"action":"remove","lines":["",""],"id":123}],[{"start":{"row":4,"column":35},"end":{"row":5,"column":0},"action":"insert","lines":["",""],"id":124}],[{"start":{"row":5,"column":0},"end":{"row":17,"column":52},"action":"insert","lines":["var mongojs \t\t= require('mongojs');","var db = {};","    db.users\t\t= mongojs('cloud',['users']).users;","    db.datacenters\t= mongojs('cloud',['datacenters']).datacenters;","    db.nodes\t\t= mongojs('cloud',['nodes']).nodes;","    db.ipblocks\t\t= mongojs('cloud',['ipblocks']).ipblocks;","    db.storages\t\t= mongojs('cloud',['storages']).storages;","    db.nodecs\t\t= mongojs('cloud',['nodecs']).nodecs;","    db.nodetokens\t= mongojs('cloud',['nodetokens']).nodetokens;","    db.managers\t\t= mongojs('cloud',['managers']).managers;","    db.plans\t\t= mongojs('cloud',['plans']).plans;","    db.servers\t\t= mongojs('cloud',['servers']).servers;","    db.images\t\t= mongojs('cloud',['images']).images;"],"id":125}],[{"start":{"row":8,"column":0},"end":{"row":17,"column":52},"action":"remove","lines":["    db.datacenters\t= mongojs('cloud',['datacenters']).datacenters;","    db.nodes\t\t= mongojs('cloud',['nodes']).nodes;","    db.ipblocks\t\t= mongojs('cloud',['ipblocks']).ipblocks;","    db.storages\t\t= mongojs('cloud',['storages']).storages;","    db.nodecs\t\t= mongojs('cloud',['nodecs']).nodecs;","    db.nodetokens\t= mongojs('cloud',['nodetokens']).nodetokens;","    db.managers\t\t= mongojs('cloud',['managers']).managers;","    db.plans\t\t= mongojs('cloud',['plans']).plans;","    db.servers\t\t= mongojs('cloud',['servers']).servers;","    db.images\t\t= mongojs('cloud',['images']).images;"],"id":126}],[{"start":{"row":7,"column":49},"end":{"row":8,"column":0},"action":"remove","lines":["",""],"id":127}],[{"start":{"row":108,"column":12},"end":{"row":109,"column":0},"action":"insert","lines":["",""],"id":128},{"start":{"row":109,"column":0},"end":{"row":109,"column":7},"action":"insert","lines":["\t\t\t\t\t\t\t"]}],[{"start":{"row":109,"column":7},"end":{"row":109,"column":20},"action":"insert","lines":["isAdmin: true"],"id":129}],[{"start":{"row":109,"column":7},"end":{"row":109,"column":8},"action":"insert","lines":["i"],"id":130}],[{"start":{"row":109,"column":8},"end":{"row":109,"column":9},"action":"insert","lines":["f"],"id":131}],[{"start":{"row":109,"column":9},"end":{"row":109,"column":10},"action":"insert","lines":["("],"id":132}],[{"start":{"row":109,"column":10},"end":{"row":109,"column":11},"action":"insert","lines":["d"],"id":133}],[{"start":{"row":109,"column":11},"end":{"row":109,"column":12},"action":"insert","lines":["a"],"id":134}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":13},"action":"insert","lines":["t"],"id":135}],[{"start":{"row":109,"column":13},"end":{"row":109,"column":14},"action":"insert","lines":["a"],"id":136}],[{"start":{"row":109,"column":14},"end":{"row":109,"column":15},"action":"insert","lines":["."],"id":137}],[{"start":{"row":109,"column":22},"end":{"row":109,"column":28},"action":"remove","lines":[": true"],"id":138},{"start":{"row":109,"column":22},"end":{"row":109,"column":23},"action":"insert","lines":[")"]}],[{"start":{"row":109,"column":10},"end":{"row":109,"column":11},"action":"insert","lines":["!"],"id":139}],[{"start":{"row":107,"column":110},"end":{"row":108,"column":0},"action":"insert","lines":["",""],"id":140},{"start":{"row":108,"column":0},"end":{"row":108,"column":6},"action":"insert","lines":["\t\t\t\t\t\t"]}],[{"start":{"row":108,"column":6},"end":{"row":108,"column":110},"action":"insert","lines":["else if(!data){ return res.json({\tstatus: 'fail',\tmessage: 'Failed to authenticate token. No user.'}); }"],"id":141}],[{"start":{"row":108,"column":19},"end":{"row":108,"column":20},"action":"insert","lines":["."],"id":142}],[{"start":{"row":108,"column":20},"end":{"row":108,"column":21},"action":"insert","lines":["i"],"id":143}],[{"start":{"row":108,"column":21},"end":{"row":108,"column":22},"action":"insert","lines":["s"],"id":144}],[{"start":{"row":108,"column":20},"end":{"row":108,"column":22},"action":"remove","lines":["is"],"id":145},{"start":{"row":108,"column":20},"end":{"row":108,"column":27},"action":"insert","lines":["isAdmin"]}],[{"start":{"row":110,"column":0},"end":{"row":110,"column":24},"action":"remove","lines":["\t\t\t\t\t\t\tif(!data.isAdmin)"],"id":146}],[{"start":{"row":109,"column":12},"end":{"row":110,"column":0},"action":"remove","lines":["",""],"id":147}],[{"start":{"row":109,"column":12},"end":{"row":110,"column":0},"action":"remove","lines":["",""],"id":148}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":13},"action":"remove","lines":["\t"],"id":149}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":13},"action":"remove","lines":["\t"],"id":150}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":13},"action":"remove","lines":["\t"],"id":151}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":13},"action":"remove","lines":["\t"],"id":152}],[{"start":{"row":109,"column":12},"end":{"row":109,"column":13},"action":"insert","lines":["\t"],"id":153}],[{"start":{"row":109,"column":13},"end":{"row":109,"column":14},"action":"insert","lines":["\t"],"id":154}],[{"start":{"row":109,"column":24},"end":{"row":110,"column":0},"action":"remove","lines":["",""],"id":155}],[{"start":{"row":109,"column":24},"end":{"row":109,"column":25},"action":"insert","lines":["\t"],"id":156}],[{"start":{"row":109,"column":25},"end":{"row":109,"column":26},"action":"insert","lines":["\t"],"id":157}],[{"start":{"row":109,"column":26},"end":{"row":109,"column":27},"action":"insert","lines":["\t"],"id":158}],[{"start":{"row":109,"column":27},"end":{"row":109,"column":28},"action":"insert","lines":["\t"],"id":159}],[{"start":{"row":109,"column":28},"end":{"row":109,"column":29},"action":"insert","lines":["\t"],"id":160}],[{"start":{"row":109,"column":29},"end":{"row":109,"column":30},"action":"insert","lines":["\t"],"id":161}],[{"start":{"row":109,"column":30},"end":{"row":109,"column":31},"action":"insert","lines":["\t"],"id":162}],[{"start":{"row":109,"column":31},"end":{"row":109,"column":32},"action":"insert","lines":["\t"],"id":163}],[{"start":{"row":109,"column":32},"end":{"row":109,"column":33},"action":"insert","lines":["\t"],"id":164}],[{"start":{"row":109,"column":33},"end":{"row":109,"column":34},"action":"insert","lines":["\t"],"id":165}],[{"start":{"row":109,"column":34},"end":{"row":109,"column":35},"action":"insert","lines":["\t"],"id":166}],[{"start":{"row":109,"column":35},"end":{"row":109,"column":36},"action":"insert","lines":["\t"],"id":167}],[{"start":{"row":109,"column":36},"end":{"row":109,"column":37},"action":"insert","lines":["\t"],"id":168}],[{"start":{"row":109,"column":37},"end":{"row":109,"column":38},"action":"insert","lines":["\t"],"id":169}],[{"start":{"row":109,"column":38},"end":{"row":109,"column":39},"action":"insert","lines":["\t"],"id":170}],[{"start":{"row":109,"column":39},"end":{"row":109,"column":40},"action":"insert","lines":["\t"],"id":171}],[{"start":{"row":108,"column":30},"end":{"row":108,"column":31},"action":"insert","lines":["\t"],"id":172}],[{"start":{"row":109,"column":17},"end":{"row":109,"column":18},"action":"insert","lines":["\t"],"id":173}],[{"start":{"row":108,"column":118},"end":{"row":108,"column":119},"action":"insert","lines":["\t"],"id":174}],[{"start":{"row":107,"column":22},"end":{"row":107,"column":23},"action":"insert","lines":["\t"],"id":175}],[{"start":{"row":107,"column":23},"end":{"row":107,"column":24},"action":"insert","lines":["\t"],"id":176}],[{"start":{"row":107,"column":24},"end":{"row":107,"column":25},"action":"insert","lines":["\t"],"id":177}],[{"start":{"row":107,"column":112},"end":{"row":107,"column":113},"action":"insert","lines":["\t"],"id":178}],[{"start":{"row":106,"column":16},"end":{"row":106,"column":17},"action":"insert","lines":["\t"],"id":179}],[{"start":{"row":106,"column":17},"end":{"row":106,"column":18},"action":"insert","lines":["\t"],"id":180}],[{"start":{"row":106,"column":18},"end":{"row":106,"column":19},"action":"insert","lines":["\t"],"id":181}],[{"start":{"row":106,"column":19},"end":{"row":106,"column":20},"action":"insert","lines":["\t"],"id":182}],[{"start":{"row":106,"column":20},"end":{"row":106,"column":21},"action":"insert","lines":["\t"],"id":183}],[{"start":{"row":106,"column":109},"end":{"row":106,"column":110},"action":"insert","lines":["\t"],"id":184}]]},"ace":{"folds":[],"scrolltop":1200,"scrollleft":0,"selection":{"start":{"row":106,"column":110},"end":{"row":106,"column":110},"isBackwards":false},"options":{"tabSize":4,"useSoftTabs":false,"guessTabSize":false,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":84,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1440683194349,"hash":"c5c92f949b7101dcd31d15f7c8d11bff92fe7191"}